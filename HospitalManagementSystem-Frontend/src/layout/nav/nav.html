<nav class="w-full top-0 z-[30] bg-gradient-to-r from-emerald-500 to-sky-500 dark:from-slate-800 dark:to-slate-900 shadow-lg">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between gap-4 h-16 md:h-20">
      <div class="flex items-center gap-3">
        <a routerLink="/" class="flex items-center gap-3 group relative overflow-hidden">
          <div 
            class="w-10 h-10 rounded-lg bg-gradient-to-br from-emerald-500 to-sky-500 flex items-center justify-center text-white font-bold shadow-md transform group-hover:scale-110 transition-all duration-300 group-active:scale-95"
          >
            <span class="group-hover:scale-110 transition-transform duration-300">MB</span>
          </div>
          <span class="text-lg font-semibold text-white tracking-wide">MediBridge</span>
          <div class="hidden sm:block">
            <span class="block font-bold text-lg text-white"
              >MyBrand</span
            >
            <span class="text-xs text-white/70"
              >Caring for Life</span
            >
          </div>
        </a>
      </div>

      <div class="flex-1 flex items-center justify-center">
        <div class="hidden md:flex items-center space-x-1 bg-white/10 dark:bg-slate-800/30 backdrop-blur-md p-1 rounded-full shadow-inner">
          <a
            routerLink="/"
            routerLinkActive="text-white font-semibold"
            [routerLinkActiveOptions]="{exact: true}"
            class="nav-link group relative px-4 py-2 font-medium text-white/90 hover:text-white transition-all duration-300 rounded-full hover:bg-white/10 hover:shadow-md hover:shadow-black/10 active:scale-[0.98]"
          >
            <span class="relative z-10">
              Home
            </span>
          </a>
          
          <a 
            *ngIf="currentUser?.role === 'Patient'"
            routerLink="/doctors"
            routerLinkActive="bg-white/25 hover:bg-white/25 text-white font-semibold shadow-lg"
            class="nav-link group relative px-5 py-2 font-medium text-white/85 hover:text-white transition-all duration-300 rounded-full hover:bg-white/15 hover:shadow-md hover:shadow-black/10 active:scale-[0.98]"
          >
            <span class="relative z-10">
              Doctors
            </span>
          </a>
          
          <a 
            *ngIf="currentUser?.role === 'Patient'"
            routerLink="/hospitals"
            routerLinkActive="bg-white/25 hover:bg-white/25 text-white font-semibold shadow-lg"
            class="nav-link group relative px-5 py-2 font-medium text-white/85 hover:text-white transition-all duration-300 rounded-full hover:bg-white/15 hover:shadow-md hover:shadow-black/10 active:scale-[0.98]"
          >
            <span class="relative z-10">
              Hospitals
            </span>
          </a>
          
          <a 
            *ngIf="currentUser?.role === 'Patient'"
            routerLink="/chat"
            routerLinkActive="bg-white/25 hover:bg-white/25 text-white font-semibold shadow-lg"
            class="nav-link group relative px-5 py-2 font-medium text-white/85 hover:text-white transition-all duration-300 rounded-full hover:bg-white/15 hover:shadow-md hover:shadow-black/10 active:scale-[0.98]"
          >
            <span class="relative z-10">
              Chat
            </span>
          </a>
          
          <a
            routerLink="/Prescription"
            routerLinkActive="bg-white/25 hover:bg-white/25 text-white font-semibold shadow-lg"
            class="nav-link group relative px-5 py-2 font-medium text-white/85 hover:text-white transition-all duration-300 rounded-full hover:bg-white/15 hover:shadow-md hover:shadow-black/10 active:scale-[0.98]"
          >
            <span class="relative z-10">
              Prescription
            </span>
          </a>
          
          <a
            routerLink="/services"
            routerLinkActive="bg-white/25 hover:bg-white/25 text-white font-semibold shadow-lg"
            class="nav-link group relative px-5 py-2 font-medium text-white/85 hover:text-white transition-all duration-300 rounded-full hover:bg-white/15 hover:shadow-md hover:shadow-black/10 active:scale-[0.98]"
          >
            <span class="relative z-10">
              Services
            </span>
          </a>
          
          <a
            routerLink="/contact"
            routerLinkActive="bg-white/25 hover:bg-white/25 text-white font-semibold shadow-lg"
            class="nav-link group relative px-5 py-2 font-medium text-white/85 hover:text-white transition-all duration-300 rounded-full hover:bg-white/15 hover:shadow-md hover:shadow-black/10 active:scale-[0.98]"
          >
            <span class="relative z-10">
              Contact
            </span>
          </a>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <ng-container *ngIf="!currentUser">
          <a
            routerLink="/login"
            class="relative hidden sm:inline-flex items-center gap-2 px-6 py-2.5 rounded-full bg-white text-slate-900 font-semibold shadow-lg hover:shadow-xl hover:shadow-black/20 transition-all duration-300 transform hover:-translate-y-0.5 hover:scale-105 active:scale-95 group overflow-hidden border border-white/20"
          >
            <span class="relative z-10 flex items-center gap-2">
              <span class="group-hover:translate-x-0.5 transition-transform duration-300">Login / Register</span>
              <span class="group-hover:translate-x-0.5 transition-transform duration-300">ğŸš€</span>
            </span>
            <span class="absolute inset-0 bg-gradient-to-r from-white/10 to-white/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></span>
          </a>
        </ng-container>

        <div class="relative user-menu-container">
          <div
            *ngIf="currentUser"
            class="hidden sm:flex items-center gap-3 px-3 py-2 rounded-full bg-white/10 hover:bg-white/15 transition cursor-pointer"
            (click)="toggleUserMenu()"
          >
            <div class="relative">
              <img
                *ngIf="currentUser?.imageUrl"
                [src]="getImageUrl(currentUser?.imageUrl)"
                [alt]="currentUser?.displayName || 'User'"
                (error)="onImageError($event)"
                class="w-10 h-10 rounded-full object-cover shadow-sm border-2 border-white/80"
              />
              <div
                *ngIf="!currentUser?.imageUrl"
                class="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-500 to-sky-500 flex items-center justify-center text-white font-semibold shadow-sm border-2 border-white/80"
              >
                {{ userInitials }}
              </div>
              <div
                class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 border-2 border-white/80 rounded-full"
              ></div>
            </div>
            <div class="flex flex-col items-start">
              <span
                class="text-sm font-semibold text-white"
                >{{ currentUser?.displayName || 'User' }}</span
              >
              <span class="text-xs text-white/70">{{
                currentUser?.role || 'Patient'
              }}</span>
            </div>
            <svg
              class="w-4 h-4 text-white/70"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"
              ></path>
            </svg>
          </div>         

          <div
            *ngIf="showUserMenu && currentUser"
            class="absolute right-0 mt-3 w-64 bg-white/95 dark:bg-slate-900/95 backdrop-blur-lg rounded-xl shadow-2xl border border-white/30 dark:border-slate-700/50 py-2 z-[80]"
            style="max-height: 500px; overflow-y: auto"
          >
            <div class="px-4 py-3 border-b border-slate-200/70 dark:border-slate-700/50">
              <div class="flex items-center gap-3">
                <img
                  *ngIf="currentUser?.imageUrl"
                  [src]="getImageUrl(currentUser?.imageUrl)"
                  [alt]="currentUser?.displayName || 'User'"
                  (error)="onImageError($event)"
                  class="w-12 h-12 rounded-full object-cover shadow-sm"
                />
                <div
                  *ngIf="!currentUser?.imageUrl"
                  class="w-12 h-12 rounded-full bg-gradient-to-br from-emerald-500 to-sky-500 flex items-center justify-center text-white font-semibold shadow-sm"
                >
                  {{ userInitials }}
                </div>
                <div>
                  <p class="text-sm font-semibold text-slate-900 dark:text-white">
                    {{ currentUser?.displayName || 'User' }}
                  </p>
                  <p class="text-xs text-slate-500 dark:text-slate-400">
                    {{ currentUser?.email || 'No email' }}
                  </p>
                  <p class="text-xs text-emerald-600 dark:text-emerald-400 font-medium">
                    {{ currentUser?.role || 'Patient' }}
                  </p>
                </div>
              </div>
            </div>

            <a
              routerLink="/profile"
              (click)="showUserMenu = false"
              class="flex items-center gap-2 px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800 transition"
            >
              ï¿½ Profile
            </a>
            <a
              routerLink="/dashboard"
              (click)="showUserMenu = false"
              class="flex items-center gap-2 px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800 transition"
            >
              ï¿½ Dashboard
            </a>
            <a
              routerLink="/my-appointments"
              (click)="showUserMenu = false"
              class="flex items-center gap-2 px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800 transition"
            >
              ï¿½ My Appointments
            </a>
            <a
              routerLink="/settings"
              (click)="showUserMenu = false"
              class="flex items-center gap-2 px-4 py-2 text-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800 transition"
            >
              âš™ï¸ Settings
            </a>
            <a
              (click)="logout(); showUserMenu = false"
              class="flex items-center gap-2 px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-950/30 transition cursor-pointer"
            >
              ğŸšª Logout
            </a>
          </div>
        </div>

        <button
          (click)="toggleMenu()"
          aria-label="Open menu"
          class="md:hidden p-2 rounded-lg hover:bg-white/10 transition"
        >
          <svg
            *ngIf="!isMenuOpen"
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6 text-white"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16m-7 6h7"
            />
          </svg>
          <svg
            *ngIf="isMenuOpen"
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6 text-white"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>


  <div class="fixed inset-0 z-40" *ngIf="isMenuOpen">
    <div
      (click)="closeMenu()"
      class="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity"
    ></div>

    <aside
      class="absolute right-4 top-[84px] w-[92%] max-w-sm bg-white/95 dark:bg-slate-900/95 rounded-xl shadow-2xl border border-white/30 dark:border-slate-700/40 p-4 transform transition duration-300"
    >
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-3">
          <div
            class="w-10 h-10 rounded-lg bg-gradient-to-br from-emerald-500 to-sky-500 flex items-center justify-center text-white font-bold"
          >
            MB
          </div>
          <div>
            <div class="font-semibold text-slate-900 dark:text-white">
              MyBrand
            </div>
            <div class="text-xs text-slate-500 dark:text-slate-300">
              Healthcare
            </div>
          </div>
        </div>
        <button
          (click)="closeMenu()"
          aria-label="Close menu"
          class="p-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-800 transition"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 text-slate-700 dark:text-slate-200"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>
      </div>

      <nav class="flex flex-col gap-2 border-b border-slate-200/50 dark:border-slate-700/50 pb-3 mb-3">
        <a
          (click)="closeMenu()"
          routerLink="/"
          routerLinkActive="active-mobile-link-style"
          class="px-3 py-2 rounded-lg hover:bg-emerald-50 dark:hover:bg-slate-800 transition text-slate-700 dark:text-slate-200 font-medium"
          >ğŸ  Home</a
        >
        <a
        *ngIf= "currentUser?.role === 'Patient'"
          (click)="closeMenu()"
          routerLink="/doctors"
          routerLinkActive="active-mobile-link-style"
          class="px-3 py-2 rounded-lg hover:bg-emerald-50 dark:hover:bg-slate-800 transition text-slate-700 dark:text-slate-200 font-medium"
          >ğŸ©º Doctors</a
        >
        <a
        *ngIf= "currentUser?.role === 'Patient'"
          (click)="closeMenu()"
          routerLink="/departments"
          routerLinkActive="active-mobile-link-style"
          class="px-3 py-2 rounded-lg hover:bg-emerald-50 dark:hover:bg-slate-800 transition text-slate-700 dark:text-slate-200 font-medium"
          >ğŸ¥ Departments</a
        >

        <a
          (click)="closeMenu()"
          routerLink="/about"
          routerLinkActive="active-mobile-link-style"
          class="px-3 py-2 rounded-lg hover:bg-emerald-50 dark:hover:bg-slate-800 transition text-slate-700 dark:text-slate-200 font-medium"
          >â„¹ï¸ About</a
        >
        <a
          (click)="closeMenu()"
          routerLink="/services"
          routerLinkActive="active-mobile-link-style"
          class="px-3 py-2 rounded-lg hover:bg-emerald-50 dark:hover:bg-slate-800 transition text-slate-700 dark:text-slate-200 font-medium"
          >ğŸ¥ Services</a
        >
        <a
          (click)="closeMenu()"
          routerLink="/contact"
          routerLinkActive="active-mobile-link-style"
          class="px-3 py-2 rounded-lg hover:bg-emerald-50 dark:hover:bg-slate-800 transition text-slate-700 dark:text-slate-200 font-medium"
          >ğŸ“ Contact</a
        >
      </nav>

      <ng-container *ngIf="!currentUser">
        <a
          routerLink="/login"
          (click)="closeMenu()"
          class="mt-4 w-full flex justify-center items-center gap-2 px-4 py-3 rounded-full bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-bold shadow-lg hover:scale-[1.02] transition"
        >
          Get Started / Login ğŸš€
        </a>
      </ng-container>

      <ng-container *ngIf="currentUser">
        <div class="mt-4 p-4 bg-slate-50 dark:bg-slate-800 rounded-lg shadow-inner">
          <div class="flex items-center gap-3">
            <div class="relative">
              <img
                *ngIf="currentUser?.imageUrl"
                [src]="getImageUrl(currentUser?.imageUrl)"
                [alt]="currentUser?.displayName || 'User'"
                (error)="onImageError($event)"
                class="w-12 h-12 rounded-full object-cover shadow-sm border-2 border-white dark:border-slate-700"
              />
              <div
                *ngIf="!currentUser?.imageUrl"
                class="w-12 h-12 rounded-full bg-gradient-to-br from-emerald-500 to-sky-500 flex items-center justify-center text-white font-semibold shadow-sm border-2 border-white dark:border-slate-700"
              >
                {{ userInitials }}
              </div>
              <div
                class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 border-2 border-white dark:border-slate-700 rounded-full"
              ></div>
            </div>
            <div class="flex-1">
              <p class="text-sm font-bold text-slate-900 dark:text-white">
                {{ currentUser?.displayName || 'User' }}
              </p>
              <p class="text-xs text-slate-500 dark:text-slate-400">
                {{ currentUser?.email || 'No email' }}
              </p>
              <p
                class="text-xs text-emerald-600 dark:text-emerald-400 font-bold"
              >
                {{ currentUser?.role || 'Patient' }}
              </p>
            </div>
          </div>
        </div>

        <div class="mt-4 space-y-2">
          <a
            routerLink="/dashboard"
            (click)="closeMenu()"
            class="block w-full text-center px-4 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold shadow-md hover:scale-[1.01] transition"
          >
            ğŸ“Š Dashboard
          </a>

          <a
            routerLink="/my-appointments"
            (click)="closeMenu()"
            class="block w-full text-center px-4 py-2 rounded-lg bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-semibold shadow-md hover:scale-[1.01] transition"
          >
            ğŸ“… My Appointments
          </a>

          <a
            routerLink="/profile"
            (click)="closeMenu()"
            class="block w-full text-center px-4 py-2 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 font-medium hover:bg-slate-200 dark:hover:bg-slate-700 transition"
          >
            ğŸ‘¤ Profile
          </a>

          <a
            routerLink="/settings"
            (click)="closeMenu()"
            class="block w-full text-center px-4 py-2 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 font-medium hover:bg-slate-200 dark:hover:bg-slate-700 transition"
          >
            âš™ï¸ Settings
          </a>
          <a
            (click)="logout(); closeMenu()"
            class="block w-full text-center px-4 py-2 rounded-lg bg-red-500 text-white font-semibold shadow-md hover:bg-red-600 transition cursor-pointer"
          >
            ğŸšª Logout
          </a>
        </div>
      </ng-container>
    </aside>
  </div>
</nav>
